import{jsPlumb as e}from"jsplumb";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach(function(t){o(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var o,i,s=[],a=!0,r=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(s.push(o.value),!t||s.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(r)throw i}}return s}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var a=function(e,t,n,o,i,s,a,r,c,l){"boolean"!=typeof a&&(c=r,r=a,a=!1);var d,f="function"==typeof n?n.options:n;if(e&&e.render&&(f.render=e.render,f.staticRenderFns=e.staticRenderFns,f._compiled=!0,i&&(f.functional=!0)),o&&(f._scopeId=o),s?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},f._ssrRegister=d):t&&(d=a?function(){t.call(this,l(this.$root.$options.shadowRoot))}:function(e){t.call(this,r(e))}),d)if(f.functional){var u=f.render;f.render=function(e,t){return d.call(t),u(e,t)}}else{var h=f.beforeCreate;f.beforeCreate=h?[].concat(h,d):[d]}return n},r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());var c=document.head||document.getElementsByTagName("head")[0],l={};var d=function(e){return function(e,t){return function(e,t){var n=r?t.media||"default":e,o=l[n]||(l[n]={ids:new Set,styles:[]});if(!o.ids.has(e)){o.ids.add(e);var i=t.source;if(t.map&&(i+="\n/*# sourceURL="+t.map.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),o.element||(o.element=document.createElement("style"),o.element.type="text/css",t.media&&o.element.setAttribute("media",t.media),c.appendChild(o.element)),"styleSheet"in o.element)o.styles.push(i),o.element.styleSheet.cssText=o.styles.filter(Boolean).join("\n");else{var s=o.ids.size-1,a=document.createTextNode(i),d=o.element.childNodes;d[s]&&o.element.removeChild(d[s]),d.length?o.element.insertBefore(a,d[s]):o.element.appendChild(a)}}}(e,t)}},f=a({render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"palette-panel"},[e._t("palette",function(){return[e._m(0)]})],2)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("ul",{staticClass:"palette-group"},[t("li",[t("div",{staticClass:"palette-default-item startpoint",attrs:{"data-type":"startpoint"}})]),t("li",[t("div",{staticClass:"palette-default-item endpoint",attrs:{"data-type":"endpoint"}})]),t("li",[t("div",{staticClass:"palette-default-item tasknode",attrs:{"data-type":"tasknode"}})]),t("li",[t("div",{staticClass:"palette-default-item gateway",attrs:{"data-type":"gateway"}})])])}]},function(e){e&&e("data-v-09b6e314_0",{source:".palette-group{margin:0;padding:0;background:#fcfcfc;text-align:center;list-style:none}.palette-group>li{padding:14px 0}.palette-default-item{display:inline-block;width:40px;height:40px;font-size:12px;color:#888;border:1px solid #999;border-radius:2px;cursor:pointer;user-select:none}.palette-default-item:hover{box-shadow:0 0 8px rgba(50,50,50,.3)}.startpoint{border-radius:50%;border:4px solid #6a6c8a}.endpoint{border-radius:50%;background:#6a6c8a}.tasknode{height:30px;border:2px solid #33d0c6}.gateway{width:30px;height:30px;background:#7c68fc;transform:rotate(-45deg)}",map:void 0,media:void 0})},{name:"PalettePanel",props:["selector"],data:function(){return{}}},void 0,!1,void 0,d,void 0),u=a({render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tool-panel"},e._l(e.tools,function(t,o){return n("div",{key:o,class:["tool-item",t.cls,{actived:"frameSelect"===t.type&&e.isFrameSelecting}],on:{click:function(n){return e.onToolClick(t)}}},[e._v("\n        "+e._s(t.name)+"\n    ")])}),0)},staticRenderFns:[]},function(e){e&&e("data-v-2c518942_0",{source:".tool-item{display:inline-block;margin-right:10px;user-select:none;cursor:pointer}.tool-item:last-child{margin-right:0}.tool-item.actived{color:#3a84ff}",map:void 0,media:void 0})},{name:"ToolPanel",props:["tools","isFrameSelecting"],data:function(){return{}},methods:{onToolClick:function(e){this.$emit("onToolClick",e)}}},void 0,!1,void 0,d,void 0),h=a({render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"bk-flow-location",on:{mousedown:this.onMouseDown,mouseup:this.onMouseUp}},["startpoint"===this.node.type?t("div",{staticClass:"circle-node startpoint"}):"endpoint"===this.node.type?t("div",{staticClass:"circle-node endpoint"}):"tasknode"===this.node.type?t("div",{staticClass:"tasknode"}):"gateway"===this.node.type?t("div",{staticClass:"gateway"}):t("div",{staticClass:"node-default"})])},staticRenderFns:[]},function(e){e&&e("data-v-f23e4578_0",{source:".bk-flow-location .circle-node{width:30px;height:30px;border-radius:50%;text-align:center}.bk-flow-location .startpoint{border:4px solid #6a6c8a}.bk-flow-location .endpoint{background:#6a6c8a}.bk-flow-location .tasknode{width:80px;height:50px;border:2px solid #33d0c6}.bk-flow-location .gateway{width:30px;height:30px;background:#7c68fc;transform:rotate(-45deg)}.bk-flow-location .node-default{width:120px;height:80px;line-height:80px;border:1px solid #ccc;border-radius:2px;text-align:center}.bk-flow-location .node-default.selected{border:1px solid #3a84ff}",map:void 0,media:void 0})},{name:"NodeTemplate",props:{node:{type:Object,default:function(){return{}}}},data:function(){return{moveFlag:{x:0,y:0,moved:!1}}},updated:function(){console.log("node update")},methods:{onMouseDown:function(e){this.moveFlag={x:e.pageX,y:e.pageY,moved:!1},this.$el.addEventListener("mousemove",this.mouseMoveHandler)},onMouseUp:function(e){var t=e.pageX,n=e.pageY;this.moveFlag.x=t,this.moveFlag.y=n,this.moveFlag.moved?(console.log("drag event"),this.moveFlag.moved=!1):console.log("click event"),this.$el.removeEventListener("mousemove",this.mouseMoveHandler)},mouseMoveHandler:function(e){var t=e.pageX,n=e.pageY;(Math.abs(t-this.moveFlag.x)>2||Math.abs(n-this.moveFlag.y)>2)&&(this.moveFlag.moved=!0)}}},void 0,!1,void 0,d,void 0);function p(e){return"touches"in e?e.touches[0]:e}var v={grid:[5,5]},m={connector:["Bezier",{curviness:30}],paintStyle:{strokeWidth:2,stroke:"#567567",outlineStroke:"tranparent",outlineWidth:6},hoverPaintStyle:{fill:"transparent",stroke:"#3a84ff"}},g={endpoint:"Dot",connector:["Flowchart",{stub:[1,6],alwaysRespectStub:!0,gap:8,cornerRadius:2}],connectorOverlays:[["PlainArrow",{width:8,length:6,location:1,id:"arrow"}]],paintStyle:{fill:"#3a84ff",radius:5},anchor:["Left","Right","Top","Bottom"],isSource:!0,isTarget:!0};function y(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="",n=0;n<7;n++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e+t}var b={showPalette:{type:Boolean,default:!0},showTool:{type:Boolean,default:!0},tools:{type:Array,default:function(){return[{type:"zoomIn",name:"放大",cls:"tool-item"},{type:"zoomOut",name:"缩小",cls:"tool-item"},{type:"resetPosition",name:"重置",cls:"tool-item"}]}},editable:{type:Boolean,default:!0},selector:{type:String,default:"palette-default-item"},data:{type:Object,default:function(){return{nodes:[],lines:[]}}},nodeOptions:{type:Object,default:function(){return n({},v)}},connectorOptions:{type:Object,default:function(){return n({},m)}},endpointOptions:{type:Object,default:function(){return n({},g)}}},w={mousedown:"ontouchstart"in document.documentElement?"touchstart":"mousedown",mousemove:"ontouchmove"in document.documentElement?"touchmove":"mousemove",mouseup:"ontouchend"in document.documentElement?"touchend":"mouseup"},C=a({render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:["jsflow",{editable:e.editable}]},[n("div",{staticClass:"canvas-area"},[e.showTool?n("div",{staticClass:"tool-panel-wrap"},[e._t("toolPanel",function(){return[n("tool-panel",{attrs:{tools:e.tools,"is-frame-selecting":e.isFrameSelecting},on:{onToolClick:e.onToolClick}})]})],2):e._e(),e.showPalette?n("div",{ref:"palettePanel",staticClass:"palette-panel-wrap"},[e._t("palettePanel",function(){return[n("palette-panel",{attrs:{selector:e.selector}})]})],2):e._e(),n("div",{ref:"canvasFlowWrap",staticClass:"canvas-flow-wrap",style:e.canvasWrapStyle,on:e._d({},[e.mousedown,e.onCanvasMouseDown,e.mouseup,e.onCanvasMouseUp])},[n("div",{ref:"canvasFlow",staticClass:"canvas-flow",attrs:{id:"canvas-flow"}},[e._l(e.nodes,function(t){return n("div",{key:t.id},[n("div",{staticClass:"jsflow-node canvas-node",attrs:{id:t.id},on:{mouseover:function(n){return e.toggleHighLight(t,!0)},mouseout:function(n){return e.toggleHighLight(t,!1)}}},[e._t("nodeTemplate",function(){return[n("node-template",{attrs:{node:t}})]},{node:t})],2)])}),n("div",{staticClass:"reference-line-vertical"}),n("div",{staticClass:"reference-line-horizontal"})],2),e.isFrameSelecting?n("div",{staticClass:"canvas-frame-selector",style:e.frameSelectorStyle}):e._e()]),e.showAddingNode?n("div",{staticClass:"jsflow-node adding-node",style:e.setNodeInitialPos(e.addingNodeConfig)},[e._t("nodeTemplate",function(){return[n("node-template",{attrs:{node:e.addingNodeConfig}})]},{node:e.addingNodeConfig})],2):e._e()])])},staticRenderFns:[]},function(e){e&&e("data-v-259afa5e_0",{source:".jsflow{height:100%;border:1px solid #ccc}.jsflow .canvas-area{position:relative;height:100%}.jsflow .tool-panel-wrap{position:absolute;top:20px;left:70px;padding:10px 20px;background:#c4c6cc;opacity:.65;border-radius:4px;z-index:4}.jsflow .palette-panel-wrap{float:left;width:60px;height:100%;border-right:1px solid #ccc}.jsflow .canvas-flow-wrap{position:relative;height:100%;overflow:hidden}.jsflow .canvas-flow{position:relative;min-width:100%;min-height:100%}.jsflow .canvas-frame-selector{position:absolute;border:1px solid #3a84ff;background:rgba(58,132,255,.15)}.jsflow .jsflow-node{position:absolute;user-select:none}.jsflow .jtk-endpoint{z-index:1;cursor:pointer}.jsflow .adding-node{opacity:.8}.jsflow .jtk-endpoint.jtk-dragging{z-index:0}.jsflow .jtk-connector{cursor:pointer}.jsflow .reference-line-vertical{display:none;position:absolute;top:-100000px;bottom:-100000px;left:0;width:2px;background:rgba(30,144,255,.8)}.jsflow .reference-line-horizontal{display:none;position:absolute;left:-100000px;right:-100000px;top:0;height:2px;background:rgba(30,144,255,.8)}",map:void 0,media:void 0})},{name:"JsFlow",components:{PalettePanel:f,ToolPanel:u,NodeTemplate:h},model:{prop:"data",event:"change"},props:b,data:function(){var e=this.data;return n({nodes:e.nodes,lines:e.lines,canvasGrabbing:!1,isFrameSelecting:!1,frameMoving:null,mouseDownPos:{},canvasPos:{x:0,y:0},canvasOffset:{x:0,y:0},frameSelectorPos:{x:0,y:0},frameSelectorRect:{width:0,height:0},selectedNodes:[],showAddingNode:!1,addingNodeConfig:{},addingNodeRect:{},canvasRect:{},paletteRect:{},zoom:1,moveTimer:null},w)},computed:{canvasWrapStyle:function(){return{cursor:this.isFrameSelecting?"crosshair":this.canvasGrabbing?"-webkit-grabbing":"-webkit-grab"}},frameSelectorStyle:function(){return{left:"".concat(this.frameSelectorPos.x,"px"),top:"".concat(this.frameSelectorPos.y,"px"),width:"".concat(this.frameSelectorRect.width,"px"),height:"".concat(this.frameSelectorRect.height,"px")}}},watch:{"data.nodes":{handler:function(e){this.nodes=e},deep:!0},editable:function(e){var t=this.$el.querySelectorAll(".canvas-node");this.toggleNodeDraggable(t,e)}},mounted:function(){this.initCanvas(),this.registerEvent(),this.renderData(),this.$refs.palettePanel&&(this.paletteRect=this.$refs.palettePanel.getBoundingClientRect(),this.registerPaletteEvent())},beforeDestroy:function(){this.$refs.palettePanel&&this.$refs.palettePanel.removeEventListener(this.mousedown,this.nodeCreateHandler),this.$el.removeEventListener(this.mousemove,this.nodeMovingHandler),document.removeEventListener(this.mouseup,this.nodeMoveEndHandler)},methods:{initCanvas:function(){var t={},o=n(n({},this.endpointOptions),this.connectorOptions);for(var i in o){var s=i[0].toUpperCase();t["".concat(s).concat(i.slice(1))]=o[i]}this.instance=e.getInstance(n({Container:"canvas-flow"},t))},registerEvent:function(){var e=this;this.instance.bind("beforeDrag",function(t){return!!e.editable&&("function"!=typeof e.$listeners.onBeforeDrag||e.$listeners.onBeforeDrag(t))}),this.instance.bind("beforeDrop",function(t){return!!e.editable&&("function"!=typeof e.$listeners.onBeforeDrop||e.$listeners.onBeforeDrop(t))}),this.instance.bind("connectionDrag",function(t){"function"==typeof e.$listeners.connectionDrag&&e.$emit("connectionDrag",t)}),this.instance.bind("connection",function(t){"function"==typeof e.$listeners.onConnection&&e.$emit("onConnection",t)}),this.instance.bind("connectionDragStop",function(t,n){if(!t.target||!t.target.classList.contains("jsflow-node")){var o=e.getNodeByEvent(n.target);if(o){var i=e.nodes.find(function(e){return o.id===e.id});if("function"==typeof e.$listeners.onConnectionDragStop){var s={id:t.source.id,arrow:t.endpoints[0].anchor.type};e.$emit("onConnectionDragStop",s,i.id,n)}}}}),this.instance.bind("beforeDetach",function(t){return"function"!=typeof e.$listeners.onBeforeDetach||e.$listeners.onBeforeDetach(t)}),this.instance.bind("connectionDetached",function(t,n){var o=e.lines.filter(function(e){return e.source.id!==t.sourceId&&e.target.id!==t.targetId});e.lines=o,"function"==typeof e.$listeners.onConnectionDetached&&e.$emit("onConnectionDetached",t)}),this.instance.bind("connectionMoved",function(t,n){"function"==typeof e.$listeners.onConnectionMoved&&e.$emit("onConnectionMoved",lines)}),this.instance.bind("click",function(t,n){"function"==typeof e.$listeners.onConnectionClick&&e.$emit("onConnectionClick",t,n)}),this.instance.bind("dblclick",function(t,n){"function"==typeof e.$listeners.onConnectionDbClick&&e.$emit("onConnectionDbClick",t,n)}),this.instance.bind("endpointClick",function(t,n){"function"==typeof e.$listeners.onEndpointClick&&e.$emit("onEndpointClick",t,n)}),this.instance.bind("endpointDblClick",function(t,n){"function"==typeof e.$listeners.onEndpointDbClick&&e.$emit("onEndpointDbClick",t,n)})},renderData:function(){var e=this;this.instance.batch(function(){e.nodes.forEach(function(t){e.initNode(t)}),e.lines.forEach(function(t){e.createConnector(t,e.connectorOptions)})})},updateCanvas:function(e){this.removeAllConnector(),this.lines=e.lines,this.nodes=e.nodes,this.renderData()},createNode:function(e){var t=this;("function"!=typeof this.$listeners.onCreateNodeBefore||this.$listeners.onCreateNodeBefore(e))&&(this.nodes.push(e),this.$nextTick(function(){t.initNode(e)}))},initNode:function(e){var t=document.getElementById(e.id);t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px"),this.setNodeDraggable(e,this.nodeOptions),this.setNodeEndPoint(e,this.endpointOptions),"function"==typeof this.$listeners.onCreateNodeAfter&&this.$emit("onCreateNodeAfter",e)},removeNode:function(e){var t=this.nodes.findIndex(function(t){return t.id===e.id});this.nodes.splice(t,1),this.instance.remove(e.id)},setNodeEndPoint:function(e,t){var o=this;(e.endpoints||["Top","Right","Bottom","Left"]).forEach(function(i){var s=o.instance.addEndpoint(e.id,n({anchor:i,uuid:i+e.id},t));s&&s.endpoint.canvas&&(s.endpoint.canvas.dataset.pos=i)})},setNodeDraggable:function(e,t){if(this.editable){var o=this;this.instance.draggable(e.id,n({grid:[20,20],drag:function(t){if(0===o.selectedNodes.length){var n=o.nodes.find(function(t){return e.id===t.id}),i=Object.assign({},n);o.setReferenceLine(e.id,t),o.setBoundaryOffset(t),o.$emit("onNodeMoving",i,t)}else{if(!o.frameMoving){var s,a,r=Math.min.apply(null,o.selectedNodes.map(function(e){return e.x})),c=Math.min.apply(null,o.selectedNodes.map(function(e){return e.y}));o.selectedNodes.some(function(e){if(e.x===r)return s=e,!0}),o.selectedNodes.some(function(e){if(e.y===c)return a=e,!0}),o.frameMoving={left:s,top:a}}o.frameMoving.left.id===e.id&&o.setFrameReferLine()}},stop:function(t){var n=-1,s=i(t.pos,2),a=s[0],r=s[1],c=o.nodes.find(function(t,o){if(t.id===e.id)return n=o,!0}),l=Object.assign({},c,{x:a,y:r});o.nodes.splice(n,1,l),o.frameMoving=null,o.$emit("onNodeMoveStop",l,t);var d=o.$refs.canvasFlow.querySelector(".reference-line-vertical"),f=o.$refs.canvasFlow.querySelector(".reference-line-horizontal");d.setAttribute("style","display: none; left: 0"),f.setAttribute("style","display: none; top: 0"),clearTimeout(this.moveTimer)}},t))}},setReferenceLine:function(e,t){var n=this,o=t.el,s=o.clientWidth,a=o.clientHeight,r=i(t.pos,2),c=[r[0]+s/2,r[1]+a/2],l=this.$refs.canvasFlow.querySelector(".reference-line-vertical"),d=this.$refs.canvasFlow.querySelector(".reference-line-horizontal");l.setAttribute("style","display: none; left: 0"),d.setAttribute("style","display: none; top: 0");var f=!1,u=!1;this.data.nodes.some(function(t){if(t.id!==e){var o=n.$refs.canvasFlow.querySelector("#".concat(t.id)),i=window.getComputedStyle(o),s=i.width,a=i.height,r=[t.x+Number(s.replace("px",""))/2,t.y+Number(a.replace("px",""))/2];return f||r[0]!==c[0]||(l.setAttribute("style","display: inline-block; left: ".concat(r[0],"px;")),f=!0),u||r[1]!==c[1]||(d.setAttribute("style","display: inline-block; top: ".concat(r[1],"px;")),u=!0),!(!f||!u)||void 0}})},setFrameReferLine:function(){var e=this,t=this.$refs.canvasFlow.querySelector("#".concat(this.frameMoving.left.id)),n=this.$refs.canvasFlow.querySelector("#".concat(this.frameMoving.top.id)),o=Number(window.getComputedStyle(t).left.replace("px","")),i=Number(window.getComputedStyle(n).top.replace("px","")),s=this.$refs.canvasFlow.querySelector(".reference-line-vertical"),a=this.$refs.canvasFlow.querySelector(".reference-line-horizontal");s.setAttribute("style","display: none; left: 0"),a.setAttribute("style","display: none; top: 0");var r=!1,c=!1;this.data.nodes.some(function(t){if(!e.selectedNodes.find(function(e){return e.id===t.id})){var n=[t.x,t.y];return r||n[0]!==o||(s.setAttribute("style","display: inline-block; left: ".concat(o,"px;")),r=!0),c||n[1]!==i||(a.setAttribute("style","display: inline-block; top: ".concat(i,"px;")),c=!0),!(!r||!c)||void 0}})},setBoundaryOffset:function(e){var t=this.$refs.canvasFlowWrap.getBoundingClientRect(),n=t.left,o=t.top,i=t.width,s=t.height;e.e.pageX<n&&this.intervalMoveCanvas("horizontal",20),e.e.pageX>n+i&&this.intervalMoveCanvas("horizontal",-20),e.e.pageY<o&&this.intervalMoveCanvas("vertical",20),e.e.pageY>o+s&&this.intervalMoveCanvas("vertical",-20)},intervalMoveCanvas:function(e,t){var n=this;this.moveTimer&&clearTimeout(this.moveTimer),this.moveTimer=setTimeout(function(){var o=n.canvasOffset,i=o.x,s=o.y;"horizontal"===e?i+=t:s+=t,n.setCanvasPosition(i,s),n.moveTimer||n.intervalMoveCanvas(e,t)},16)},setNodePosition:function(e){var t=document.getElementById(e.id);t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px"),this.instance.revalidate(t)},toggleNodeDraggable:function(e,t){this.instance.setDraggable(e,t)},setNodeInitialPos:function(e){return{left:"".concat(e.x,"px"),top:"".concat(e.y,"px"),visibility:e.visible?"initial":"hidden"}},createConnector:function(e,t){var o=e.options||{};return this.instance.connect({source:e.source.id,target:e.target.id,uuids:[e.source.arrow+e.source.id,e.target.arrow+e.target.id]},n(n({},t),o))},setConnector:function(e,t,n){var o=this;this.instance.getAllConnections().filter(function(n){return n.sourceId===e&&n.targetId===t}).forEach(function(e){e.setConnector(n),o.endpointOptions&&o.endpointOptions.connectorOverlays&&o.endpointOptions.connectorOverlays.forEach(function(t){e.addOverlay(t)})})},removeConnector:function(e){var t=this;this.instance.getConnections({source:e.source.id,target:e.target.id}).forEach(function(e){t.instance.deleteConnection(e)})},removeAllConnector:function(){this.instance.deleteEveryConnection(),this.lines=[]},getConnectorsByNodeId:function(e){return this.instance.getAllConnections().filter(function(t){return t.sourceId===e||t.targetId===e})},getNodeByEvent:function(e){var t=e.parentNode;return!(!t||"HTML"===t.nodeName)&&(t.classList.contains("jsflow-node")?t:this.getNodeByEvent(t))},addLineOverlay:function(e,t){var n=this;this.instance.getConnections({source:e.source.id,target:e.target.id}).forEach(function(e){e.addOverlay([t.type,{label:t.name,location:t.location,cssClass:t.cls,id:t.id,events:{click:function(e,t){n.$emit("onOverlayClick",e,t)}}}])})},removeLineOverlay:function(e,t){this.instance.getConnections({source:e.source.id,target:e.target.id}).forEach(function(e){e.removeOverlay(t)})},onCanvasMouseDown:function(e){0===e.button&&(e=p(e),this.isFrameSelecting?this.frameSelectHandler(e):(this.canvasGrabbing=!0,this.mouseDownPos={x:e.pageX,y:e.pageY},this.$refs.canvasFlowWrap.addEventListener(this.mousemove,this.canvasFlowMoveHandler,!1)))},canvasFlowMoveHandler:function(e){e=p(e),this.canvasOffset={x:this.canvasPos.x+e.pageX-this.mouseDownPos.x,y:this.canvasPos.y+e.pageY-this.mouseDownPos.y},this.$refs.canvasFlow.style.left="".concat(this.canvasOffset.x,"px"),this.$refs.canvasFlow.style.top="".concat(this.canvasOffset.y,"px")},onCanvasMouseUp:function(e){this.isFrameSelecting?this.frameSelectEndHandler(e):(this.canvasGrabbing=!1,this.$refs.canvasFlowWrap.removeEventListener(this.mousemove,this.canvasFlowMoveHandler),this.canvasPos={x:this.canvasOffset.x,y:this.canvasOffset.y})},registerPaletteEvent:function(){this.$refs.palettePanel.addEventListener(this.mousedown,this.nodeCreateHandler,!1)},nodeCreateHandler:function(e){var t=this,o=function e(t,n){return 1===t.nodeType&&t.classList.contains(n)?t:"HTML"!==t.parentNode.nodeName?e(t.parentNode,n):null}(e.target,this.selector);if(o){var i=o.dataset.type?o.dataset.type:"",s={};for(var a in o.dataset){var r=a.match(/(config)(\w*)/);if(r&&""!==r[2]){var c=r[2],l=c[0].toLowerCase()+c.slice(1);s[l]=o.dataset[a]}}this.showAddingNode=!0,this.addingNodeConfig.id=y("node"),this.addingNodeConfig.type=i,this.$nextTick(function(){var o=t.$el.querySelector(".adding-node");t.addingNodeRect=o.getBoundingClientRect();var a=t.getAddingNodePos(e);t.addingNodeConfig=n({id:y("node"),type:i,x:a.x,y:a.y,adding:!0,visible:!1},s),t.$el.addEventListener(t.mousemove,t.nodeMovingHandler,!1),document.addEventListener(t.mouseup,t.nodeMoveEndHandler,!1)})}},nodeMovingHandler:function(e){var t=this.getAddingNodePos(e);this.$set(this.addingNodeConfig,"x",t.x),this.$set(this.addingNodeConfig,"y",t.y),this.$set(this.addingNodeConfig,"visible",!0)},nodeMoveEndHandler:function(e){if(this.$el.removeEventListener(this.mousemove,this.nodeMovingHandler),document.removeEventListener(this.mouseup,this.nodeMoveEndHandler),this.showAddingNode=!1,e.pageX>this.paletteRect.left+this.paletteRect.width){var t=this.addingNodeConfig.x-this.paletteRect.width-this.canvasOffset.x,n=this.addingNodeConfig.y-this.canvasOffset.y;this.$set(this.addingNodeConfig,"x",t),this.$set(this.addingNodeConfig,"y",n),delete this.addingNodeConfig.adding,delete this.addingNodeConfig.visible,this.createNode(this.addingNodeConfig)}this.addingNodeConfig={},this.addingNodeRect={}},getAddingNodePos:function(e){return{x:e.pageX-this.paletteRect.left-this.addingNodeRect.width/2,y:e.pageY-this.paletteRect.top-this.addingNodeRect.height/2}},toggleHighLight:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.editable){var o=document.getElementById(e.id);this.instance.selectEndpoints({source:o}).each(function(e){var o;n?(o=t.endpointOptions.hoverPaintStyle,e.endpoint.canvas.classList.add("jtk-endpoint-highlight")):(o=t.endpointOptions.paintStyle,e.endpoint.canvas.classList.remove("jtk-endpoint-highlight")),o&&e.setStyle(o)})}},onToolClick:function(e){"function"==typeof this[e.type]&&this[e.type](),this.$emit("onToolClick",e)},setZoom:function(e,t,n){this.instance.setContainer("canvas-flow"),this.$refs.canvasFlow.style.transform="matrix("+e+",0,0,"+e+","+t+","+n+")",this.$refs.canvasFlow.style.transformOrigin="0 0",this.$refs.canvasFlow.zoom=e,this.zoom=e,this.instance.setZoom(e)},zoomIn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=this.zoom*e,i=t-t*o,s=n-n*o;o>2||this.setZoom(o,i,s)},zoomOut:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=this.zoom*e,i=t-t*o,s=n-n*o;o<.1||this.setZoom(o,i,s)},resetPosition:function(){this.setZoom(1,0,0),this.setCanvasPosition(0,0)},setCanvasPosition:function(e,t){this.canvasOffset={x:e,y:t},this.canvasPos={x:e,y:t},this.$refs.canvasFlow.style.left=this.canvasOffset.x+"px",this.$refs.canvasFlow.style.top=this.canvasOffset.y+"px"},frameSelect:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isFrameSelecting=e},onOpenFrameSelect:function(){this.frameSelect()},onCloseFrameSelect:function(){this.frameSelect(!1)},frameSelectHandler:function(e){this.canvasRect=this.$refs.canvasFlowWrap.getBoundingClientRect(),this.mouseDownPos={x:e.clientX-this.canvasRect.left,y:e.clientY-this.canvasRect.top},this.$refs.canvasFlowWrap.addEventListener(this.mousemove,this.frameSelectMovingHandler,!1)},frameSelectMovingHandler:function(e){var t=e.clientX-this.mouseDownPos.x-this.canvasRect.left,n=e.clientY-this.mouseDownPos.y-this.canvasRect.top;this.frameSelectorRect={width:Math.abs(t),height:Math.abs(n)},this.frameSelectorPos={x:t>0?this.mouseDownPos.x:this.mouseDownPos.x+t,y:n>0?this.mouseDownPos.y:this.mouseDownPos.y+n}},frameSelectEndHandler:function(e){this.$refs.canvasFlowWrap.removeEventListener(this.mousemove,this.frameSelectMovingHandler),this.$refs.canvasFlowWrap.removeEventListener(this.mouseup,this.frameSelectEndHandler),document.addEventListener(this.mousedown,this.cancelFrameSelectorHandler,{capture:!1,once:!0});var t=this.getSelectedNodes(),n=t.map(function(e){return e.id}),o=this.mouseDownPos,i=o.x,s=o.y;this.isFrameSelecting=!1,this.frameSelectorPos={x:0,y:0},this.frameSelectorRect={width:0,height:0},this.selectedNodes=t,this.clearNodesDragSelection(),this.addNodesToDragSelection(n),this.$emit("onFrameSelectEnd",t.slice(0),i,s)},getSelectedNodes:function(){var e=this,t=this.frameSelectorPos,n=t.x,o=t.y,i=this.frameSelectorRect,s=i.width,a=i.height;return this.nodes.filter(function(t){var i=document.querySelector("#".concat(t.id)).getBoundingClientRect(),r=i.left-e.canvasRect.left,c=i.top-e.canvasRect.top;if(n<r&&n+s>r&&o<c&&o+a>c)return!0})},cancelFrameSelectorHandler:function(e){this.selectedNodes=[],this.clearNodesDragSelection(),this.$emit("onCloseFrameSelect")},addNodesToDragSelection:function(e){e.forEach(function(e){var t=document.querySelector("#".concat(e));t&&t.classList.add("selected")}),this.instance.addToDragSelection(e)},clearNodesDragSelection:function(){document.querySelectorAll(".jsflow-node.selected").forEach(function(e){e.classList.remove("selected")}),this.instance.clearDragSelection()}}},void 0,!1,void 0,d,void 0);"undefined"!=typeof window&&"Vue"in window&&window.Vue.component("js-flow",C);export default C;
